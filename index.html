<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¢ ëŒ€ì‚°í•­ Seetec í¬íŠ¸ í˜„í™©íŒ</title>
    <style>
        :root { --bg: #f4f7f6; --open: #2ecc71; --closed: #e74c3c; --none: #dfe6e9; --text: #2d3436; --fix: #f39c12; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: var(--text); }
        .container { max-width: 800px; margin: 0 auto; background: #fff; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* í—¤ë” ë° ìƒíƒœ ë°°ì§€ */
        .header { background: #34495e; color: #fff; padding: 20px; text-align: center; position: relative; }
        .conn-status { position: absolute; top: 10px; right: 15px; font-size: 0.7rem; padding: 4px 8px; border-radius: 20px; background: rgba(0,0,0,0.3); }
        .conn-status.online { border: 1px solid var(--open); color: var(--open); }
        .conn-status.fix { border: 1px solid var(--fix); color: var(--fix); }

        /* ë³´ì•ˆ í”½ìŠ¤ëª¨ë“œ íŒ¨ë„ */
        .fix-panel { background: #fff9e6; padding: 15px; border-bottom: 1px solid #ffeaa7; display: none; text-align: center; }
        .fix-panel.active { display: block; }
        textarea { width: 90%; height: 80px; margin-top: 10px; font-size: 0.7rem; border-radius: 5px; border: 1px solid #ddd; padding: 10px; }

        .month-nav { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; padding: 15px; background: #f8f9fa; }
        .m-btn { border: 1px solid #ddd; background: #fff; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        .m-btn.active { background: #3498db; color: #fff; border-color: #3498db; }

        .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); background: #fff; padding: 15px 5px; border-bottom: 2px solid #f1f2f6; }
        .stat-item { text-align: center; border-right: 1px solid #eee; }
        .stat-item:last-child { border-right: none; }
        .stat-label { font-size: 0.75rem; color: #636e72; font-weight: bold; display: block; margin-bottom: 5px; }
        .stat-val { font-size: 1.1rem; font-weight: 800; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        .weekday { background: #f1f2f6; text-align: center; padding: 10px 0; font-size: 0.8rem; font-weight: bold; border-bottom: 1px solid #eee; }
        .day-cell { border-right: 1px solid #eee; border-bottom: 1px solid #eee; min-height: 90px; position: relative; background: #fff; }
        .day-num { font-size: 0.75rem; font-weight: bold; padding: 5px; color: #636e72; }
        
        .slot-container { display: flex; flex-direction: column; height: 65px; gap: 2px; padding: 2px; }
        .slot { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; border-radius: 3px; font-weight: bold; cursor: pointer; }
        .slot.none { background: var(--none); color: #999; cursor: default; }
        .slot.open { background: var(--open); color: #fff; }
        .slot.closed { background: var(--closed); color: #fff; }

        .footer { padding: 20px; text-align: center; font-size: 0.8rem; color: #95a5a6; border-top: 1px solid #eee; background: #fcfcfc; }
        .creator { font-weight: bold; color: #2c3e50; font-size: 0.9rem; }

        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #fff; padding: 25px; border-radius: 15px; text-align: center; width: 85%; max-width: 300px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div id="connBadge" class="conn-status">ì—°ê²° í™•ì¸ ì¤‘...</div>
        <h2>ğŸš¢ ëŒ€ì‚°í•­ Seetec í˜„í™©íŒ</h2>
        <button id="fixToggle" onclick="toggleFixMode()" style="background:var(--fix); color:#fff; border:none; padding:6px 12px; border-radius:5px; font-size:0.75rem; cursor:pointer; font-weight:bold;">ë³´ì•ˆ ë¸”ë¡/í”½ìŠ¤ëª¨ë“œ ì „í™˜</button>
    </div>

    <div id="fixPanel" class="fix-panel">
        <strong>âš ï¸ ë³´ì•ˆ í”½ìŠ¤ëª¨ë“œ (ì˜¤í”„ë¼ì¸ ìˆ˜ë™ ì…ë ¥)</strong><br>
        <span style="font-size:0.75rem">êµ¬ê¸€ ì‹œíŠ¸ë‚˜ ì—‘ì…€ì˜ ë°ì´í„°ë¥¼ ë³µì‚¬í•˜ì—¬ ì•„ë˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</span><br>
        <textarea id="manualData" placeholder="ë‚ ì§œ	ì‹œê°„	Low	High	Status í˜•ì‹ìœ¼ë¡œ ë¶™ì—¬ë„£ê¸°..."></textarea>
        <button onclick="applyManualData()" style="margin-top:8px; padding:8px 20px; background:#34495e; color:#fff; border:none; border-radius:4px; cursor:pointer;">ë°ì´í„° ì¦‰ì‹œ ì ìš©</button>
    </div>

    <div class="month-nav" id="monthNav"></div>
    
    <div class="stats-bar">
        <div class="stat-item"><span class="stat-label">ğŸŸ¢ ì˜¤í”ˆìœ¨</span><span id="openRatio" class="stat-val" style="color:var(--open)">0%</span></div>
        <div class="stat-item"><span class="stat-label">ğŸ”´ í´ë¡œì§• íšŸìˆ˜</span><span id="closedCount" class="stat-val" style="color:var(--closed)">0íšŒ</span></div>
        <div class="stat-item"><span class="stat-label">ğŸš« í´ë¡œì§• ë¹„ìœ¨</span><span id="closedRatio" class="stat-val" style="color:var(--closed)">0%</span></div>
    </div>

    <div class="calendar-grid" id="calendar">
        <div class="weekday">ì¼</div><div class="weekday">ì›”</div><div class="weekday">í™”</div>
        <div class="weekday">ìˆ˜</div><div class="weekday">ëª©</div><div class="weekday">ê¸ˆ</div><div class="weekday">í† </div>
    </div>

    <div class="footer">
        <p>Created by <span class="creator">JS Kim of LAM</span></p>
        <p style="font-size: 0.7rem; margin-top: 5px;">Â© 2026 LAM. All port data verified for Daesan Seetec.</p>
    </div>
</div>

<div id="modal" onclick="closeModal()"><div class="modal-content" onclick="event.stopPropagation()">
    <div id="mDate" style="font-weight:bold; margin-bottom:10px; color:#7f8c8d;"></div>
    <div id="mStatus" style="font-weight:bold; font-size:1.3rem;"></div>
    <div id="mWave" style="font-weight:800; margin:20px 0; font-size:1.1rem;"></div>
    <button onclick="closeModal()" style="padding:10px 25px; border-radius:5px; border:1px solid #ddd; cursor:pointer;">ì°½ ë‹«ê¸°</button>
</div></div>

<script>
    const year = 2026;
    let currentMonth = new Date().getMonth() + 1;
    let globalData = {};
    let isFixMode = false;

    // êµ¬ê¸€ ì‹œíŠ¸ CSV ì¶œë ¥ URL
    const sheetCsvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSGrqzEdgECvgskv4CW-1-FdlAXq1ZIYomFapbQidCM8i2avijanfPHgOKk8Ajtyrt8a6VqbSvpT6uN/pub?output=csv";

    function init() {
        const nav = document.getElementById('monthNav');
        for(let m=1; m<=12; m++) {
            const btn = document.createElement('button');
            btn.className = `m-btn ${m === currentMonth ? 'active' : ''}`;
            btn.innerText = `${m}ì›”`;
            btn.onclick = () => {
                document.querySelectorAll('.m-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMonth = m;
                renderCalendar(m);
            };
            nav.appendChild(btn);
        }
        syncWithGoogleSheets();
    }

    async function syncWithGoogleSheets() {
        const badge = document.getElementById('connBadge');
        try {
            const response = await fetch(sheetCsvUrl);
            if (!response.ok) throw new Error("Network blocked");
            const csvText = await response.text();
            parseCsvData(csvText);
            badge.innerText = "â— ì˜¨ë¼ì¸ ì—°ê²° ì„±ê³µ";
            badge.className = "conn-status online";
            renderCalendar(currentMonth);
        } catch (error) {
            badge.innerText = "â— ë³´ì•ˆ ë¸”ë¡ (í”½ìŠ¤ëª¨ë“œ í•„ìš”)";
            badge.className = "conn-status fix";
            toggleFixMode(true);
        }
    }

    function parseCsvData(csv) {
        const lines = csv.split('\n');
        globalData = {};
        for(let i=1; i<lines.length; i++) {
            const cols = lines[i].split(',');
            if(cols.length >= 5) {
                const date = cols[0].trim();
                if(!globalData[date]) globalData[date] = [];
                globalData[date].push({ t: cols[1], r: cols[3], s: cols[4].trim() });
            }
        }
    }

    function toggleFixMode(force = null) {
        isFixMode = force !== null ? force : !isFixMode;
        document.getElementById('fixPanel').classList.toggle('active', isFixMode);
    }

    function applyManualData() {
        const input = document.getElementById('manualData').value;
        if(!input) return;
        try {
            const rows = input.trim().split('\n');
            rows.forEach(row => {
                const cols = row.split('\t'); // ì—‘ì…€/ì‹œíŠ¸ ë³µì‚¬ëŠ” íƒ­ìœ¼ë¡œ êµ¬ë¶„ë¨
                if (cols.length >= 4) {
                    const date = cols[0].trim();
                    if (!globalData[date]) globalData[date] = [];
                    // ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ ì²˜ë¦¬
                    globalData[date] = globalData[date].filter(item => item.t !== cols[1]);
                    globalData[date].push({ t: cols[1], r: cols[3], s: cols[4] ? cols[4].trim() : (parseFloat(cols[3]) >= 2.5 ? "Closed" : "Open") });
                }
            });
            renderCalendar(currentMonth);
            alert("í”½ìŠ¤ëª¨ë“œ ë°ì´í„°ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch(e) { alert("ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); }
    }

    function renderCalendar(month) {
        const grid = document.getElementById('calendar');
        grid.querySelectorAll('.day-cell').forEach(c => c.remove());
        const firstDay = new Date(year, month - 1, 1).getDay();
        const daysInMonth = new Date(year, month, 0).getDate();
        
        let totalSlots = 0, openSlots = 0, closedSlots = 0;

        for(let i=0; i<firstDay; i++) grid.innerHTML += `<div class="day-cell" style="background:#f9f9f9"></div>`;

        for(let d=1; d<=daysInMonth; d++) {
            const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            const records = globalData[dateStr] || [];
            let slotsHtml = `<div class="slot-container">`;
            
            const periods = [{k:"ì˜¤ì „", l:"AM"}, {k:"ì˜¤í›„", l:"PM"}];
            let hasData = false;

            periods.forEach(p => {
                const record = records.find(r => r.t.includes(p.k));
                if(record) {
                    hasData = true; totalSlots++;
                    const isClosed = record.s.toLowerCase() === "closed";
                    if(isClosed) closedSlots++; else openSlots++;
                    slotsHtml += `<div class="slot ${isClosed?'closed':'open'}" onclick="showDetail('${dateStr}', '${record.t}', '${record.r}', '${record.s}')">${isClosed?'ğŸ”´':'ğŸŸ¢'} ${p.l}</div>`;
                }
            });
            if (!hasData) slotsHtml += `<div class="slot none">AM</div><div class="slot none">PM</div>`;
            grid.innerHTML += `<div class="day-cell"><div class="day-num">${d}</div>${slotsHtml}</div>`;
        }
        updateStats(totalSlots, openSlots, closedSlots);
    }

    function updateStats(t, o, c) {
        const ratio = t > 0 ? Math.round((o / t) * 100) : 0;
        document.getElementById('openRatio').innerText = ratio + "%";
        document.getElementById('closedCount').innerText = c + "íšŒ";
        document.getElementById('closedRatio').innerText = (t > 0 ? (100 - ratio) : 0) + "%";
    }

    function showDetail(d, t, r, s) {
        document.getElementById('mDate').innerText = d + " (" + t + ")";
        const isClosed = s.toLowerCase() === 'closed';
        document.getElementById('mStatus').innerText = isClosed ? 'ğŸ”´ PORT CLOSED' : 'ğŸŸ¢ PORT OPEN';
        document.getElementById('mStatus').style.color = isClosed ? '#e74c3c' : '#2ecc71';
        document.getElementById('mWave').innerText = "ìµœëŒ€ íŒŒê³ (Max): " + r;
        document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    window.onload = init;
</script>
</body>
</html>
